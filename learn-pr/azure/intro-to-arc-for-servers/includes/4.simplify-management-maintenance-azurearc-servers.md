


Azure Policy is a service that helps manage and evaluate internal and regulatory compliance of cloud and on-premises environments. Azure Policy uses declarative rules based on properties of target resource types, including Windows and Linux operating systems. These rules form policy definitions, which administrators can apply through policy assignment to resource groups, subscriptions, or management groups that host Azure and Azure Arc enabled resources. To simplify management of policy definitions, it is possible to combine multiple policies into initiatives, and then create a few of initiative assignments in lieu of multiple policy assignments.

Azure Policy supports auditing the state of Arc enabled server with Guest Configuration policies. Guest Configuration policies do not apply configurations, but they audit settings within the target operating system and evaluate their compliance. You can, however, use Azure Policy to apply configuration of the Azure resource representing an Arc enabled server. You also have the ability to use Azure Policy to deploy configurations by leveraging VM extensions.

For example, Contoso could use Azure Policy to implement the following rules:

- Assigning a specific tag to resources representing Arc enabled servers during their registration.
- Identify Arc enabled servers running Windows with Windows Defender Exploit Guard disabled.
- Identify Arc enabled servers running Windows that are not joined to a specific Active Directory Domain Services (AD DS) domain.
- Identify Arc enabled servers running Windows or Linux without Log Analytics agent installed.
- Identify Arc enabled servers running Linux that are not using SSH keys for authentication.

:::image type="content" source="../media/3-assign-policy.png" alt-text="The screenshot depicts the Assign policy page in the Azure portal. The administrator is selecting from a list of available policies." border="false":::

Azure Arc enables you to extend some capabilities of *Azure Policy* to operating systems of computers that are in on-premises datacenters or are hosted on another cloud provider. This functionality applies to auditing the compliance of settings for the OS, applications, and environment.

Additionally, you can configure the time zone on servers that are running the Windows Server OS. You can also use Azure Policy to manage and evaluate compliance for Azure Arc enabled Kubernetes clusters. Enabling this functionality requires that you install the Azure Connected Machine agent on each computer in the scope of management.

> [!NOTE]
> Currently, you can only audit settings in this context. Auto-remediation is not yet available.


## What is Azure Policy?

*Azure Policy* is a service that can help organizations manage and evaluate compliance for their Azure environments' organizational standards. Azure Policy uses declarative rules based on properties of target Azure resource types. These rules form policy definitions, which administrators can apply through policy assignment to a resource group or subscription.

For example, to simplify management of policy definitions, Contoso could consider combining multiple policies into initiatives and then create a few initiative assignments instead of multiple policy assignments.

Azure Policy functionality groups into four main categories:

- Enforcing compliance when provisioning new Azure resources.
- Auditing the compliance of existing Azure resources.
- Remediating noncompliance of existing Azure resources.
- Auditing the compliance of the OS, application configuration, and environment settings within Azure VMs.

> [!TIP]
> The last of these categories implements by using the Azure Policy Guest Configuration client, which is available as an Azure VM extension. Azure Arc for servers uses the same client to provide auditing functionality in hybrid scenarios.

Specifically, Contoso IT support could use Azure Policy to assign tags to resources during their deployment.

After you install the agent, it requires outbound connectivity to Azure Arc over TCP port 443. At that point, any Azure Policy Guest Configuration client-based configuration that's in the assigned policy or initiative definition will automatically take effect.

### Assign policies with Azure Arc

To manage and assign Azure Arc policies for a computer, browse to Azure Arc in the Azure portal. In the returned list of managed servers, select the appropriate server, and then assign a policy to it. You'll need to configure the:

- Scope and any exclusions from the scope of the policy.
- Policy definition.
- Assignment name.
- Description.
- Policy enforcement (Enabled or Disabled).

:::image type="content" source="../media/6-assign-policy.png" alt-text="The screenshot depicts the Assign policy page in the Azure portal. The administrator is selecting from a list of available policies." border="false":::

After assigning policies, you can review the policy settings on the selected server from Azure Arc.

:::image type="content" source="../media/6-review-policies.png" alt-text="The screenshot depicts the applied policies on ContosoVM1. Two policies are applied, and the VM is compliant with one but not the other." border="false":::














Another important advantage of Azure Arc is its ability to centralize and standardize enterprise-wide management and monitoring of technology assets regardless of their location. In this unit, you will learn how this principle applies to Azure Stack HCI clusters.

## How to leverage Azure Arc to centralize monitoring of Azure Stack HCI clusters?

With Azure Arc, the Azure portal can provide a centralized dashboard for status monitoring and a launching pad for management of all your Azure Stack HCI clusters, along with all of your Azure and Azure Arc enabled resources. The home page for the Azure Stack HCI resources lists all of your clusters, along with their resource group, location, and associated subscription. For each cluster, you can readily identify its name, OS version, OS build, model, total number of CPU cores, and its nodes. For each node, the portal displays its manufacturer, model, serial number, total number of CPU cores, the amount of memory, as well as OS version and OS build. 

More in-depth monitoring, alerting, log collection, and log analytics are available through integration with Azure Monitor. The simplest way to onboard your cluster to Azure Monitor is by using the automated workflow in Windows Admin Center, which first provisions a Log Analytics workspace in the target Azure subscription and then configures the Health Service and installs the Log Analytics agent on each cluster node. Alternatively, you can accomplish the same outcome by using Windows PowerShell. 

Once this process is completed, cluster nodes will start forwarding telemetry and logs to Azure Monitor, which you can subsequently display via Azure Monitor dashboards and analyze via Log Analytics queries. You also have the option of implementing metric or log-based rules that will trigger alerts and auto-remediation tasks. 

Cloud-based monitoring might potentially eliminate the need for an on-premises monitoring system. If you have existing Azure resources, this will provide a uniform monitoring solution that leverages cloud hyperscale and seamlessly integrates with other Azure services. 

## What is the purpose of Azure Resource Manager activity log, access control, locks, and tags in case of Azure Stack HCI clusters?

Just as with Azure enabled servers, the Azure portal offers the interface from which you can monitor activity log and manage access control, tags, and locks associated with the Azure resource representing each of your Azure Stack HCI clusters. The Azure Resource Manager activity log provides a list of recent operations and events on the cluster along with their status, time, associated subscription, and initiating user. You can filter events by subscription, severity, time span, resource group, and resource. Access control settings allow you to review and modify role assignments that grant permissions to the Azure resource. By creating a resource lock, you can prevent accidental changes or deletions of the Azure Stack HCI cluster resource. Tags allow you enable you to categorize resources and facilitate consolidated billing. 


Choose the best response for each of the questions below. Then select "Check your answers".
