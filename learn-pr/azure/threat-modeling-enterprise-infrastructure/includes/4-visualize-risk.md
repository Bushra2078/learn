Now that you have the answers, the next step in the infrastructure threat modeling process is to:

- Simplify your meeting notes into more actionable chunks of information, and
- Create a data-flow diagram.

## Summarized meeting notes

|Category|Summary|
|--------|-------|
|![Access Control domain](../media/AccessControl-small.svg)<br>Access control|<ul><li>Users: employees, admins, vendors.</li><li>Corporate network access with generic VPN.</li><li>NAS - sensitive files (code, system config, backups), READ - all, READ/WRITE - admins.</li><li>Build servers - READ - all, WRITE - admins.</li><li>File share server - READ - all, WRITE - admins.</li><li>Access given according to need for individual users.</li><li>O365 - single factor authentication, no password expiration.</li><li>Github - single factor authentication, no password expiration.</li><li>Domain Controller - used for local machine access only, no group policy.</li><li>No password requirements.</li><li>Local credentials for Linux machine access.</li><li>Shared accounts - for conference rooms, shared passwords, same permissions as users.</li><li>AAD used for O365 access.</li><li>Decentralized identities - each system uses a different credential.</li><li>No enforced 2FA/MFA.</li><li>No separate accounts used to make sensitive system changes.</li></ul>|
|![Secure Development domain](../media/SecureDevelopment-small.svg)<br>Secure development|<ul><li>SDL not implemented formally.</li><li>Potentially unsafe open-source bug management solution.</li><li>Weak authentication for GitHub.</li></ul>|
|![Business Continuity domain](../media/BusinessContinuity-small.svg)<br>Business continuity|<ul><li>Critical systems backup - NAS (weekly, not encrypted), removable drive (monthly, not encrypted).</li><li>No formalized business continuity and disaster recovery plan.</li><li>No audits or recovery tests on backups.</li></ul>|
|![Cryptography domain](../media/Cryptography-small.svg)<br>Cryptography|<ul><li>Self-signed certificates on dev environment.</li><li>Verisign certificates for public facing websites.</li><li>No key rotation.</li></ul>|
|![Asset Management domain](../media/Asset-small.svg)<br>Asset management|<ul><li>No data retention.</li><li>No classification or labeling.</li><li>Folders treated as labeling mechanism.</li><li>Folder access is unrestricted.</li><li>No asset disposal or deprecation plan.</li><li>Data is not encrypted on shared drives and servers.</li><li>No Data Leakage Prevention (DLP) mechanisms.</li><li>NAS - stores code artifacts, configuration files, and short-term backups (SQL server, domain controller, and build servers).</li><li>OneDrive currently being implemented to replace shared storage.</li><li>Enterprise machines are not disk encrypted.</li><li>Stations not locked when employees leave their stations.</li></ul>|
|![Legal domain](../media/Legal-small.svg)<br>Legal|<ul><li>Non-Disclosure Agreements (NDA) and asset use agreements signed.</li><li>Background checks conducted.</li><li>Specialized team handles financial regulatory compliance.</li></ul>|
|![Incident Response domain](../media/IncidentResponse-small.svg)<br>Incident response|<ul><li>No incident response program for enterprise.</li><li>No incident response program for product.</li></ul>|
|![Network domain](../media/Network-small.svg)<br>Network|<ul><li>Network is unsegmented.</li><li>Firewall has a basic set of inbound and outbound rules.</li><li>VPN takes credentials and a token, which is pre-generated by the IT administrator, to create a secure connection to the corporate network.</li></ul>|
|![Operations domain](../media/Operations-small.svg)<br>Operations|<ul><li>Manual, unplanned patches and updates done on assets by the IT administrators.</li><li>Basic Antivirus (AV) solution installed on every machine, but no way to enforce or verify.</li><li>No group policy exists to enforce timeout sessions on machines.</li><li>No Mobile Device Management (MDM) solution.</li><li>Logging and monitoring is minimal, made up of only of basic VPN and firewall actions.</li><li>No intelligence platform or analytics service.</li><li>Only default rules are used for the firewall.</li><li>Firewall logs are kept locally for seven days, and then erased to make space for the more recent logs.</li><li>Changes to the production environment require management approval.</li></ul>|
|![Physical and environmental domain](../media/Physical-small.svg)<br>Physical and environmental|<ul><li>5 build servers, 1 domain controller, 1 NAS in an unlocked IT room.</li><li>No cameras or access records for the IT room.</li><li>RFID for building access.</li><li>Building owner has access to all rooms and floors.</li><li>No building cameras or guards.</li><li>Visitors are escorted by the employee, but there is no official check-in or front desk.</li></ul>|
|![Governance domain](../media/Governance-small.svg)<br>Governance|<ul><li>No information security policy or risk management program.</li><li>No security training offerings.</li></ul>|
|![Security architecture domain](../media/SecurityArchitecture-small.svg)<br>Security architecture|<ul><li>Virtual Machines (VM) are created using default images.</li><li>Security baselines not configured.</li><li>Hybrid infrastructure can lead to holes in the firewall and access control issues if implemented incorrectly.</li><li>No IoT or container used in the enterprise.</li></ul>|
|![Supplier risk domain](../media/Supplier-small.svg)<br>Supplier|<ul><li>No supplier management exists.</li></ul>|

## General assumptions

To build this diagram, we make the following assumptions:

- **No trust** - data-flow initiates from outside of the corporate network.
- **Context level** - data-flow diagram begins with a high-level context diagram, followed by additional,
more in-depth diagrams as needed. Refer to the [Provide context with the right depth layer module](https://docs.microsoft.com/en-us/learn/modules/tm-provide-context-with-the-right-depth-layer/) from the [Threat Modeling Security Fundamentals](https://docs.microsoft.com/en-us/learn/paths/tm-threat-modeling-fundamentals/) learning path for more information.

## Data-flow diagram

Let's revisit what each shape means:

### Element definition

|Element|Shape|Definition|Example|
|-------|-----|----------|-------|
|Process|![Process](../media/process50.png)|Task that receives, modifies, or redirects input to output|Services|
|Data store|![Data Store](../media/data-store50.png)|Permanent and temporary data storage|NAS, AD Store, Removable Drive|
|External entity|![External Entity](../media/external-entity50.png)|Task, entity, or data store outside of your direct control|Users, third-party APIs|
|Data-flow|![Data-flow](../media/data-flow50.png)|Data movement between processes, data stores, and external entities|Credentials, files, connection strings, payloads|
|Trust boundary|![Trust Boundary Box](../media/trust-boundary-box50.png) ![Trust Boundary Line](../media/trust-boundary-line50.png)|Trust zone changes as data flows through the system|User connection to the corporate network, corporate firewall connecting to Azure|

### Woodgrove elements

Now, let's enumerate all the processes, data stores, external entities, data-flows, and trust boundaries for Woodgrove:

|Element|Component|
|-------|---------|
|![Process](../media/process25.png)</br>Process|<ul><li>O365</li><li>Open-source bug management service</li><li>SaaS offerings (grouped)</li><li>GitHub</li><li>Machine</li><li>Firewall service</li><li>VPN service</li><li>NAS file share service</li><li>Logging and monitoring service</li><li>NAS backup service</li><li>SQL server</li><li>Build servers (grouped)</li><li>Active directory service</li><li>Removable drive backup service</li><li>Azure Iaas</li></ul>|
|![Data Store](../media/data-store25.png)</br>Data store|<ul><li>Credentials and tokens VPN store</li><li>NAS store</li><li>Logging and monitoring store</li><li>Active directory store</li><li>Removable drive store</li></ul>|
|![External Entity](../media/external-entity25.png)</br>External entity|<ul><li>User</li></ul>|
|![Data-flow](../media/data-flow25.png)</br>Data-flow|<ul><li>Request and responses between element connections</li></ul>|
|![Trust Boundary Box](../media/trust-boundary-box25.png)</br>![Trust Boundary Line](../media/trust-boundary-line25.png)</br>Trust boundary|<ul><li>Woodgrove Corporate Boundary</li><li>Azure IaaS Boundary</li></ul>|

### Connected elements

Once the elements are fleshed out, it's time to create the flows between them. Here's the list:

#### User interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![External Entity](../media/external-entity25.png)</br>User|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>O365||<ul><li>Authentication tokens</li><li>Data requests and responses</li></ul>|
|![External Entity](../media/external-entity25.png)</br>User|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Bug management service|||
|![External Entity](../media/external-entity25.png)</br>User|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>SaaS offerings (grouped)|||
|![External Entity](../media/external-entity25.png)</br>User|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>GitHub|||
|![External Entity](../media/external-entity25.png)</br>User|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Machine|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/user-tm-screenshot.PNG" alt-text="User interactions in data-flow diagram":::

#### Machine and Github service interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>GitHub|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![External entity](../media/external-entity25.png)</br>User|||
|![Process](../media/process25.png)</br>GitHub|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Firewall service|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Internet - Corporate</li></ul>|
|![Process](../media/process25.png)</br>Machine|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![External entity](../media/external-entity25.png)</br>User||
|![Process](../media/process25.png)</br>Machine|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Firewall service|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Internet - Corporate</li></ul>|
|![Process](../media/process25.png)</br>Machine|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Active Directory service|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Internet - Corporate</li></ul>|

Here's an example of what the interactions would look like:

:::image type="content" source="../media/machine-github-tm-screenshot.PNG" alt-text="Machine and Github interactions in data-flow diagram":::

#### Firewall Service interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Machine|![Checkmark](../media/check25.png)||
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>GitHub|![Checkmark](../media/check25.png)||
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>VPN service|||
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Build servers (grouped)|||
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Logging and monitoring service|||
|![Process](../media/process25.png)</br>Firewall service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Azure IaaS|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Corporate - Azure</li></ul>|

Here's an example of what the interactions would look like:

:::image type="content" source="../media/firewall-tm-screenshot.PNG" alt-text="Firewall interactions in data-flow diagram":::

#### VPN interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>VPN service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/data-store25.png)</br>Firewall service|||
|![Process](../media/process25.png)</br>VPN service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Credentials and tokens VPN store|||
|![Process](../media/process25.png)</br>VPN service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS file share service|||
|![Process](../media/process25.png)</br>VPN service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>SQL server|||
|![Data store](../media/data-store25.png)</br>Credentials and tokens VPN store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>VPN service|||
|![Data store](../media/data-store25.png)</br>Credentials and tokens VPN store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/vpn-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### NAS interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>NAS file share service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/data-store25.png)</br>VPN service|||
|![Process](../media/process25.png)</br>NAS file share service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>NAS store|||
|![Data store](../media/data-store25.png)</br>NAS store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS file share service|||
|![Data store](../media/data-store25.png)</br>NAS store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>NAS store|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Credentials and tokens VPN store|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Active Directory store|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Logging and monitoring store|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>SQL server|||
|![Process](../media/process25.png)</br>NAS backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Build servers (grouped)|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/nas-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### Server interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>SQL server|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Removable drive backup service|||
|![Process](../media/process25.png)</br>SQL server|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||
|![Process](../media/process25.png)</br>SQL server|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>VPN service|||
|![Process](../media/process25.png)</br>Build servers (grouped)|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Removable drive backup service|||
|![Process](../media/process25.png)</br>Build servers (grouped)|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||
|![Process](../media/process25.png)</br>Build servers (grouped)|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Firewall service|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/servers-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### Logging and monitoring interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>Logging and monitoring service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Firewall service|||
|![Process](../media/process25.png)</br>Logging and monitoring service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Logging and monitoring store|||
|![Process](../media/data-store25.png)</br>Logging and monitoring store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||
|![Process](../media/data-store25.png)</br>Logging and monitoring store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Logging and monitoring service|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/logging-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### Active Directory interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Data store](../media/data-store25.png)</br>Active directory store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Active directory service|||
|![Data store](../media/data-store25.png)</br>Active directory store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>NAS backup service|||
|![Process](../media/process25.png)</br>Active directory service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Removable drive backup service|||
|![Process](../media/process25.png)</br>Active directory service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Machine|||
|![Process](../media/process25.png)</br>Active directory service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Active Directory store|||

Here's an example of what the interactions would look like:

:::image type="content" source="../media/ad-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### Removable drive interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>Removable drive backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Data store](../media/data-store25.png)</br>Removable drive store|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Corporate - Internet</li></ul>|
|![Process](../media/process25.png)</br>Removable drive backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>SQL server||<ul><li><strong>Boundary:</strong> Corporate - Internet</li></ul>|
|![Process](../media/process25.png)</br>Removable drive backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Build servers (grouped)||<ul><li><strong>Boundary:</strong> Corporate - Internet</li></ul>|
|![Process](../media/process25.png)</br>Removable drive backup service|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Active directory service||<ul><li><strong>Boundary:</strong> Corporate - Internet</li></ul>|
|![Data store](../media/data-store25.png)</br>Removable drive store|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Removable drive backup service|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Corporate - Internet</li></ul>|

Here's an example of what the interactions would look like:

:::image type="content" source="../media/removable-drive-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

#### Azure interactions

|Element one|Data-flow direction|Element two|Crosses boundary|Details|
|-----------|-------------------|-----------|----------------|-------|
|![Process](../media/process25.png)</br>Azure IaaS|![Bi-directional Flow](../media/biflow25.png)</br>Bi-directional|![Process](../media/process25.png)</br>Firewall service|![Checkmark](../media/check25.png)|<ul><li><strong>Boundary:</strong> Corporate - Azure</li></ul>|

Here's an example of what the interactions would look like:

:::image type="content" source="../media/azure-tm-screenshot.PNG" alt-text="VPN interactions in data-flow diagram":::

### Finished diagram

Here's what the finished data-flow diagram looks like:

:::image type="content" source="../media/infra-tm.PNG" alt-text="VPN interactions in data-flow diagram":::

