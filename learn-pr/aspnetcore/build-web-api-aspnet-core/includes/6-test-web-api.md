It's time to test the CRUD actions that were added to the web API. A quality assurance engineer on your team has written a script to smoke test the entire API.

## Test the web API

Run the following command:

```bash
. <(wget -q -O - https://aka.ms/create-web-api-aspnet-core-test)
```

The command downloads and runs a script that sends seven sequential requests to the web API. See the Cloud Shell for the individual `curl` commands that were sent.

## Review the web API test results

The following headings appear in the order in which the seven requests were sent.

### HTTP POST: Add an invalid product

An HTTP POST request was sent with an invalid `Product` object. The following response is generated:

```console
HTTP/2 400
date: Thu, 11 Feb 2021 21:10:37 GMT
content-type: application/problem+json; charset=utf-8
server: Kestrel

{
  "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
  "title": "One or more validation errors occurred.",
  "status": 400,
  "traceId": "|af98c13-40a6004c5194c147.",
  "errors": {
    "Price": [
      "The field Price must be between 0.01 and 9999.99."
    ]
  }
}
```

An HTTP 400 status code is returned because the controller's `[ApiController]` attribute triggers Model validation on the request body. ASP.NET Core MVC's Model binder attempts to serialize the `curl` command's `-d` JSON to a `Product` object. Model validation fails because the request's `Price` value is less than the minimum value of 0.01.

An error result has a status code of 400 or higher. ASP.NET Core MVC transforms an error result to a :::no-loc text="[ProblemDetails](/dotnet/api/microsoft.aspnetcore.mvc.problemdetails)"::: type. `ProblemDetails` provides a machine-readable error format that adheres to the [RFC 7807 specification](https://tools.ietf.org/html/rfc7807). The `application/problem+json` media type in the `content-type` response header indicates the response is of type `ProblemDetails`.

### HTTP POST: Add a valid product

An HTTP POST request was sent with a valid `Product` object. The following response is generated:

```console
HTTP/2 201
date: Thu, 11 Feb 2021 21:10:37 GMT
content-type: application/json; charset=utf-8
location: https://localhost:5001/Products/3
server: Kestrel

{"id":3,"name":"Plush Squirrel","price":12.99}
```

The successful creation of the product results in:

* An HTTP 201 status code in the response header. This status code was generated by the following highlighted line:

  :::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_Post" highlight="7":::

* A `location` response header with a URL to retrieve the newly created product.
* A JSON representation of the newly created product.

### HTTP GET: Retrieve an invalid product

An HTTP GET request was sent to retrieve a product that doesn't exist. The following `ProblemDetails` response is generated:

```console
HTTP/2 404
date: Thu, 11 Feb 2021 21:10:37 GMT
content-type: application/problem+json; charset=utf-8
server: Kestrel

{
  "type": "https://tools.ietf.org/html/rfc7231#section-6.5.4",
  "title": "Not Found",
  "status": 404,
  "traceId": "|af98c16-40a6004c5194c147."
}
```

The successful retrieval of the product results in an HTTP 404 status code in the response header. This status code was generated by the following highlighted line:

:::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_GetById" highlight="8":::

### HTTP GET: Retrieve a valid product

An HTTP GET request was sent to retrieve the Plush Squirrel product by its unique identifier, which is 3. The following response is generated:

```console
HTTP/2 200
date: Thu, 11 Feb 2021 21:10:37 GMT
content-type: application/json; charset=utf-8
server: Kestrel

{
  "id": 3,
  "name": "Plush Squirrel",
  "price": 12.99
}
```

The successful retrieval of the product results in:

* An HTTP 200 status code in the response header. This status code was generated by the following highlighted line:

  :::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_GetById" highlight="11":::

* A JSON representation of the Plush Squirrel product.

### HTTP PUT: Update a product

An HTTP PUT request was sent to change the Knotted Rope product's price from 12.99 to 14.99. The following response is generated:

```console
HTTP/2 204
date: Thu, 11 Feb 2021 21:10:37 GMT
server: Kestrel
```

The HTTP 204 status code was generated by the following highlighted line:

:::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_Put" highlight="12":::

### HTTP DELETE: Remove a product

An HTTP DELETE request was sent to remove the product with a unique identifier of 1. The following response is generated:

```console
HTTP/2 204
date: Thu, 11 Feb 2021 21:10:37 GMT
server: Kestrel
```

The HTTP 204 status code was generated by the following highlighted line:

:::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_Delete" highlight="14":::

### HTTP GET: Retrieve all products

An HTTP GET request was sent to retrieve all products in the inventory. The following response is generated:

```console
HTTP/2 200
date: Thu, 11 Feb 2021 21:10:37 GMT
content-type: application/json; charset=utf-8
server: Kestrel

[
  {
    "id": 2,
    "name": "Knotted Rope",
    "price": 14.99
  },
  {
    "id": 3,
    "name": "Plush Squirrel",
    "price": 12.99
  }
]
```

The successful retrieval of the products list results in:

* An HTTP 200 status code in the response header. This status code was generated by the following highlighted line:

  :::code language="csharp" source="../code/controllers/productscontroller.cs" id="snippet_GetAll" highlight="3":::

* A JSON representation of the products in inventory.
